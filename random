import pandas as pd

def is_after_dr(row):
    if row['entity_type'] != "PERSON":
        return False
    
    # Extract full text and start index of the PHI entity
    full_text = row['Text']
    start_idx = row['start']

    # Get the text before the PHI span
    before = full_text[:start_idx].lower().strip()

    # Tokenize to get the last word before the entity
    words = before.split()
    if not words:
        return False

    return words[-1].rstrip(".") == "dr"

# Apply row-wise filtering
df_filtered = df[~df.apply(is_after_dr, axis=1)]
