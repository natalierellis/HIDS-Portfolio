<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Austin Cherian, Natalie Ellis, and David Angel">

<title>Final Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_proposal_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_proposal_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_proposal_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_proposal_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_proposal_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_proposal_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_proposal_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_proposal_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_proposal_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_proposal_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final Project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Austin Cherian, Natalie Ellis, and David Angel </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="syntheticmguh-hypertension-care-quality-improvement-report" class="level1">
<h1>SyntheticMGUH Hypertension Care Quality Improvement Report</h1>
<p>Hypertension is a chronic medical condition characterized by persistently elevated blood pressure and is prevalent among the patient population at MGUH. Due to the increasing number of patients, the health system’s hypertension clinics have become overwhelmed. In response, system administrators have tasked our team with assessing whether hypertension management can be improved in primary care clinics to reduce unnecessary referrals.</p>
<section id="the-objective-of-this-analysis-is-twofold" class="level4">
<h4 class="anchored" data-anchor-id="the-objective-of-this-analysis-is-twofold">The objective of this analysis is twofold:</h4>
<p><strong>Determine a denominator</strong>: Identify the total number of adult patients with essential hypertension in our healthcare system.</p>
<p><strong>Evaluate care adequacy</strong>: Quantify how many of these patients are referred to hypertension clinics without receiving adequate management in primary care.</p>
<p>For this study, “<strong>adequate primary care</strong>” for hypertension management is defined as meeting both of the following criteria before referral to a hypertension clinic:</p>
<ol type="1">
<li>Patients should have been prescribed at least one guideline-recommended <strong>anti-hypertensive medication</strong>.</li>
<li>Patients should have a <strong>documented care plan</strong> outlining treatment goals, follow-up schedules, and lifestyle interventions for hypertension.</li>
</ol>
</section>
<section id="our-analysis-will-follow-these-steps" class="level4">
<h4 class="anchored" data-anchor-id="our-analysis-will-follow-these-steps">Our analysis will follow these steps:</h4>
<ol type="1">
<li><strong>Data Extraction:</strong> Identify adult patients with essential hypertension from the EHR system using relevant diagnosis codes.</li>
<li><strong>Referral Analysis:</strong> Determine how many of these patients were referred to hypertension clinics and evaluate their records for adequate primary care management.</li>
<li><strong>Outcome Assessment:</strong> Calculate the proportion of referred patients meeting the defined criteria.</li>
</ol>
<p>If the majority of patients referred to the hypertension clinic have received adequate primary care, we will recommend implementing more stringent referral criteria to prioritize patients requiring specialized or emergency care.</p>
<p>In such cases, referrals to the hypertension clinic should be reserved for life-threatening conditions based on established international guidelines. We propose adopting the referral criteria outlined by the British and Irish Hypertension Society <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10803252/">(1)</a>, which include:</p>
<ul>
<li><p><strong>Malignant/Accelerated-Phase Hypertension:</strong></p>
<ul>
<li>Blood pressure ≥180/120 mmHg accompanied by retinal hemorrhages or papilledema (optic disc swelling).</li>
</ul></li>
<li><p><strong>Hypertensive Crisis with Target-Organ Damage:</strong></p>
<ul>
<li>Life-threatening complications, regardless of blood pressure severity, including but not limited to: Acute Aortic Dissection, Acute Kidney Injury, Acute Myocardial Ischemia (Heart Attack), Acute Heart Failure, Acute Stroke, Pheochromocytoma</li>
</ul></li>
<li><p><strong>Pre-Eclampsia and Severe Hypertension in Pregnancy:</strong></p>
<ul>
<li>Requires a multi-disciplinary team approach due to the risk to both mother and fetus.</li>
</ul></li>
</ul>
<p>Referral to a hypertension clinic would only be indicated given one of these criteria.</p>
</section>
</section>
<section id="defining-patient-cohorts" class="level1">
<h1>Defining Patient Cohorts</h1>
<section id="hypertension-patient-cohort" class="level2">
<h2 class="anchored" data-anchor-id="hypertension-patient-cohort">Hypertension patient cohort</h2>
<p>Our hypertension cohort consists of patient records extracted from the <strong>encounters</strong>, <strong>procedures</strong>, <strong>medications</strong>, <strong>conditions</strong>, and <strong>careplans</strong> tables, where the corresponding <code>reasondescription</code> or <code>description</code> field indicates a diagnosis of <strong>Essential Hypertension</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> hypertension_cohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a common table expression (CTE) to identify all unique patients with hypertension</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> all_hypertension_cohort <span class="kw">AS</span> (</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Identify patients from the 'encounters' table where the reason for the visit includes "hypertension"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> encounters</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">LOWER</span>(reasondescription) <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">UNION</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Identify patients from the 'procedures' table where the procedure description includes "hypertension"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> procedures</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">LOWER</span>(reasondescription) <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">UNION</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Identify patients from the 'medications' table where the medication reason includes "hypertension"</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> medications</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">LOWER</span>(reasondescription) <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">UNION</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Identify patients from the 'conditions' table where the condition description includes "hypertension"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> conditions</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">LOWER</span>(description) <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">UNION</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Identify patients from the 'careplans' table where the care plan description includes "hypertension"</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> careplans</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> <span class="fu">LOWER</span>(reasondescription) <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a refined CTE containing demographic information for all hypertension patients</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>hypertension_cohort <span class="kw">AS</span> (</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        ahc.patient,              <span class="co">-- Patient ID from the previous CTE</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        birthdate,                <span class="co">-- Patient's date of birth</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        deathdate,                <span class="co">-- Patient's recorded date of death</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        race,                     <span class="co">-- Patient's race</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        ethnicity,                <span class="co">-- Patient's ethnicity</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        gender,                   <span class="co">-- Patient's gender</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        date_part(<span class="st">'year'</span>, age(<span class="st">'2020-09-24'</span>, birthdate)) <span class="kw">as</span> age <span class="co">-- Patient's age as of 2020-09-24</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> all_hypertension_cohort ahc</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span> patients <span class="kw">ON</span> patients.<span class="kw">id</span> <span class="op">=</span> ahc.patient </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Only include patients who were alive on or after 2019-09-24</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- We assume a NULL deathdate means the patient is still alive</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (deathdate <span class="kw">IS</span> <span class="kw">NULL</span> <span class="kw">OR</span> deathdate <span class="op">&gt;</span> <span class="st">'2019-09-24'</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a temporary table to store the final cohort of hypertension patients</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> hypertension_cohort</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_cohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hypertension-patients-with-referral-to-cardiologist-cohort" class="level2">
<h2 class="anchored" data-anchor-id="hypertension-patients-with-referral-to-cardiologist-cohort">Hypertension Patients with Referral to Cardiologist Cohort</h2>
<p>We enhanced the hypertension patient cohort by adding a <strong><code>referral</code></strong> column, indicating whether each patient has been referred to a <strong>hypertension clinic</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> hypertension_referral_cohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a CTE to identify patients referred to a hypertension clinic</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> referral_cohort <span class="kw">AS</span> (</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Select distinct patients with referral procedure codes linked to encounters</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">ON</span> (p.patient) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        p.patient,        <span class="co">-- Unique patient ID</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        p.code,           <span class="co">-- Procedure code (referral)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        p.<span class="kw">stop</span>,           <span class="co">-- End date of the procedure</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        e.reasoncode,     <span class="co">-- Reason code from the corresponding encounter</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span> <span class="kw">AS</span> referral     <span class="co">-- Indicator that the patient received a referral</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> procedures p</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> encounters e <span class="kw">ON</span> p.encounter <span class="op">=</span> e.<span class="kw">id</span> <span class="co">-- Link procedures to encounters by encounter ID</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> p.code <span class="op">=</span> <span class="dv">183856001</span>    <span class="co">-- Procedure code for referral to hypertension clinic</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> e.reasoncode <span class="op">=</span> <span class="dv">59621000</span> <span class="co">-- Reason code for essential hypertension</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create another CTE combining patient demographic data with referral data</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>hypertension_referral_cohort <span class="kw">AS</span> (</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        hc.patient,             <span class="co">-- Patient ID from the hypertension cohort</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        hc.birthdate,           <span class="co">-- Patient's date of birth</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        hc.deathdate,           <span class="co">-- Patient's date of death (if applicable)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        hc.race,                <span class="co">-- Patient's race</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        hc.ethnicity,           <span class="co">-- Patient's ethnicity</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        hc.gender,              <span class="co">-- Patient's gender</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        hc.age,                 <span class="co">-- Patient's calculated age</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        rc.referral,            <span class="co">-- Indicator of referral from the referral cohort</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        rc.<span class="kw">stop</span> <span class="kw">AS</span> referral_stop_date <span class="co">-- Date when the referral procedure was completed</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> hypertension_cohort hc</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> referral_cohort rc <span class="kw">ON</span> hc.patient <span class="op">=</span> rc.patient</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Ensure only active patients are included (alive after the cutoff date)</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (hc.deathdate <span class="kw">IS</span> <span class="kw">NULL</span> <span class="kw">OR</span> hc.deathdate <span class="op">&gt;</span> <span class="st">'2019-09-24'</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a temporary table to store the final referral cohort data</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> TEMP <span class="kw">TABLE</span> hypertension_referral_cohort</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referral_cohort;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proportion-of-hypertension-patients-and-referrals" class="level2">
<h2 class="anchored" data-anchor-id="proportion-of-hypertension-patients-and-referrals">Proportion of Hypertension Patients and Referrals</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Calculate percentage</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(referral) <span class="kw">AS</span> referred_patients,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> total_hypertension_patients,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(referral) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> percentage_referred <span class="co">-- percentage of hypertension patients referred to the cardiologist </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referral_cohort hc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">referred_patients</th>
<th style="text-align: right;">total_hypertension_patients</th>
<th style="text-align: right;">percentage_referred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">207</td>
<td style="text-align: right;">9418</td>
<td style="text-align: right;">2.197919</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Our hypertension cohort includes 9,418 patients, of whom 207 were referred to a hypertension clinic, representing 2.20% of the total cohort.</p>
</section>
</section>
<section id="demographics" class="level1">
<h1>Demographics</h1>
<section id="gender" class="level3">
<h3 class="anchored" data-anchor-id="gender">Gender</h3>
<p>The gender breakdown is weighted towards men.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> gender, <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">as</span> patients</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> hypertension_referral_cohort</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> referral <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> gender</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">gender</th>
<th style="text-align: right;">patients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">F</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="even">
<td style="text-align: left;">M</td>
<td style="text-align: right;">106</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age">Age</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="fu">floor</span>(age<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span> <span class="kw">as</span> age_group, <span class="fu">count</span>(<span class="op">*</span>) patients</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> hypertension_referral_cohort</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> referral <span class="op">=</span><span class="dv">1</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> age_group <span class="kw">ORDER</span> <span class="kw">BY</span> age_group</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>9 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">age_group</th>
<th style="text-align: right;">patients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: right;">60</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">70</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">80</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="compliance-with-primary-care-protocols-for-hypertensive-care" class="level1">
<h1>Compliance with Primary Care Protocols for Hypertensive Care</h1>
<section id="care-plans" class="level2">
<h2 class="anchored" data-anchor-id="care-plans">Care Plans</h2>
<p>How many hypertension patients with a referral have a hypertension-related care plan?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> cp <span class="kw">AS</span> (</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient, <span class="kw">stop</span>, <span class="dv">1</span> <span class="kw">AS</span> care_plan</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> careplans</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> description <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>cp_cohort <span class="kw">AS</span> (</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> hc.patient, cp.<span class="kw">stop</span> <span class="kw">AS</span> cp_stop_date, hc.referral_stop_date, care_plan, referral</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referral_cohort hc</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> cp <span class="kw">ON</span> hc.patient <span class="op">=</span> cp.patient</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> cp.<span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span> <span class="kw">OR</span> cp.<span class="kw">stop</span> <span class="op">&lt;</span> hc.referral_stop_date</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span> (hc.deathdate <span class="kw">IS</span> <span class="kw">NULL</span> <span class="kw">OR</span> hc.deathdate <span class="op">&gt;</span> <span class="st">'2019-09-24'</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(care_plan) <span class="kw">AS</span> care_plan_patients, </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">SUM</span>(referral) <span class="kw">AS</span> referral_patients, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">SUM</span>(care_plan) <span class="op">*</span> <span class="fl">100.0</span><span class="op">/</span><span class="fu">SUM</span>(referral) <span class="kw">AS</span> percent_with_careplans</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> cp_cohort</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> referral <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">/* 29046, 4023, 32968, 5640, 111280, 259255, 197313, 2027, 1045, 5489, 2071, 1977, 6918, 8659, 11289, 309362, 3522, 6902 */</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">care_plan_patients</th>
<th style="text-align: right;">referral_patients</th>
<th style="text-align: right;">percent_with_careplans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">207</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>All <strong>hypertension patients with a referral</strong> (100%) have a documented <strong>hypertension-related care plan</strong> in their medical records.</p>
</section>
<section id="medications" class="level2">
<h2 class="anchored" data-anchor-id="medications">Medications</h2>
<p>How many hypertension patients with a referral are on at least one of the recommended anti-hypertensive medications prior to the referral?</p>
<section id="proportion-of-hypertension-referral-patients-with-hypertension-medications" class="level3">
<h3 class="anchored" data-anchor-id="proportion-of-hypertension-referral-patients-with-hypertension-medications">proportion of hypertension referral patients with hypertension medications</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> hypertension_meds <span class="kw">AS</span> (</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- ACE Inhibitors</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'ACE Inhibitors'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'lisinopril|enalapril|ramipril'</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- ARBs (Angiotensin II Receptor Blockers)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'ARBs'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'losartan|valsartan|candesartan'</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">-- Calcium Channel Blockers</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'Calcium Channel Blockers'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'amlodipine|diltiazem|nifedipine'</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">-- Thiazide Diuretics</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'Thiazide Diuretics'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'hydrochlorothiazide|chlorthalidone'</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">-- Beta Blockers</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'Beta Blockers'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'atenolol|metoprolol|propranolol'</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">-- Aldosterone Antagonists</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'Aldosterone Antagonists'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'spironolactone|eplerenone'</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">-- Direct Vasodilators</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">'Direct Vasodilators'</span> <span class="kw">AS</span> <span class="kw">type</span>, code, description, <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> patient) <span class="kw">AS</span> patients</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> medications</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'hydralazine|minoxidil'</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> (<span class="kw">stop</span> <span class="kw">BETWEEN</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="st">'2020-09-24'</span> <span class="kw">OR</span> (<span class="kw">start</span> <span class="op">&gt;=</span> <span class="st">'2019-09-24'</span> <span class="kw">AND</span> <span class="kw">stop</span> <span class="kw">IS</span> <span class="kw">NULL</span>))</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">type</span>, code, description</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> hypertension_meds</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">type</span>, patients <span class="kw">DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 7%">
<col style="width: 65%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">type</th>
<th style="text-align: right;">code</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">patients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">314076</td>
<td style="text-align: left;">lisinopril 10 MG Oral Tablet</td>
<td style="text-align: right;">4135</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">314077</td>
<td style="text-align: left;">lisinopril 20 MG Oral Tablet</td>
<td style="text-align: right;">68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">311354</td>
<td style="text-align: left;">lisinopril 5 MG Oral Tablet</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">197884</td>
<td style="text-align: left;">lisinopril 40 MG Oral Tablet</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">197887</td>
<td style="text-align: left;">hydrochlorothiazide 25 MG / lisinopril 20 MG Oral Tablet</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">197885</td>
<td style="text-align: left;">hydrochlorothiazide 12.5 MG / lisinopril 10 MG Oral Tablet</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">311353</td>
<td style="text-align: left;">lisinopril 2.5 MG Oral Tablet</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">197886</td>
<td style="text-align: left;">hydrochlorothiazide 12.5 MG / lisinopril 20 MG Oral Tablet</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">261962</td>
<td style="text-align: left;">ramipril 10 MG Oral Capsule</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACE Inhibitors</td>
<td style="text-align: right;">858817</td>
<td style="text-align: left;">enalapril maleate 10 MG Oral Tablet</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> referrals <span class="kw">AS</span> (</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> hypertension_referral_cohort</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> referral <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>hypertension_referrals <span class="kw">AS</span> (</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> r.patient patients_with_any_medication, <span class="dv">1</span> <span class="kw">AS</span> meds, referral</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> referrals r</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> medications <span class="kw">ON</span> medications.patient <span class="op">=</span> r.patient</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- ACE Inhibitors</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'lisinopril|enalapril|ramipril'</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- ARBs (Angiotensin II Receptor Blockers)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'losartan|valsartan|candesartan'</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- Calcium Channel Blockers</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'amlodipine|diltiazem|nifedipine'</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">-- Thiazide Diuretics</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'hydrochlorothiazide|chlorthalidone'</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">-- Beta Blockers</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'atenolol|metoprolol|propranolol'</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">-- Aldosterone Antagonists</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'spironolactone|eplerenone'</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="kw">OR</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">-- Direct Vasodilators</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">LOWER</span>(description) ~<span class="op">*</span> <span class="st">'hydralazine|minoxidil'</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(meds) <span class="kw">AS</span> with_medication_patients,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(referral) <span class="kw">AS</span> total_cohort,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(meds) <span class="op">*</span><span class="fl">100.0</span> <span class="op">/</span><span class="fu">SUM</span>(referral) <span class="kw">AS</span> percentage_of_cohort_with_meds</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referrals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 18%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">with_medication_patients</th>
<th style="text-align: right;">total_cohort</th>
<th style="text-align: right;">percentage_of_cohort_with_meds</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">207</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>All <strong>hypertension patients with a referral</strong> (100%) have been prescribed an appropriate <strong>anti-hypertensive medication.</strong></p>
</section>
</section>
</section>
<section id="adding-more-stringent-criteria" class="level1">
<h1>Adding more stringent criteria</h1>
<p>Since all patients in our <strong>hypertension-referral cohort</strong> have met the criteria for <strong>basic primary care hypertension management</strong>, we will implement <strong>more stringent referral standards</strong> as outlined in the introduction.</p>
<section id="malignantaccelerated-phase-hypertension.-blood-pressure-180120" class="level2">
<h2 class="anchored" data-anchor-id="malignantaccelerated-phase-hypertension.-blood-pressure-180120">Malignant/accelerated phase hypertension. Blood pressure ≥180/120</h2>
<p>What percent of hypertension patients with a referral have had their most recent lab test show a systolic BP greater than 180 and a diastolic BP greater than 120?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> recent_bp_readings <span class="kw">AS</span> (</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Get the most recent systolic and diastolic BP readings per patient</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        o.patient, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        o.code, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        o.description, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">CAST</span>(o.<span class="fu">value</span> <span class="kw">AS</span> <span class="dt">FLOAT</span>) <span class="kw">AS</span> value_float,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        o.<span class="dt">date</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> observations o</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> encounters e <span class="kw">ON</span> o.encounter <span class="op">=</span> e.<span class="kw">id</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> e.reasondescription <span class="kw">LIKE</span> <span class="st">'%hypertension%'</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> o.code <span class="kw">IN</span> (<span class="st">'8480-6'</span>, <span class="st">'8462-4'</span>) <span class="co">-- Systolic and Diastolic BP codes</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> <span class="dt">date</span> <span class="op">&lt;=</span> <span class="st">'2020-09-24'</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> o.patient, o.code, o.<span class="dt">date</span> <span class="kw">DESC</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>most_recent_bp <span class="kw">AS</span> (</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Use DISTINCT ON to keep the latest systolic and diastolic readings per patient</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">ON</span> (patient, code)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        patient, </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        code, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        value_float, </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        description, </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">date</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> recent_bp_readings</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> patient, code, <span class="dt">date</span> <span class="kw">DESC</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DISTINCT</span> patient, </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    description,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    value_float</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    most_recent_bp bp</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    (bp.code <span class="op">=</span> <span class="st">'8480-6'</span> <span class="kw">AND</span> bp.value_float <span class="op">&gt;=</span> <span class="dv">180</span>) <span class="co">-- Systolic BP</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">OR</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    (bp.code <span class="op">=</span> <span class="st">'8462-4'</span> <span class="kw">AND</span> bp.value_float <span class="op">&gt;=</span> <span class="dv">120</span>) <span class="co">-- Diastolic BP</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top">
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">patient</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">value_float</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p>It turns out that no patients in our hypertension referral cohort have had their most recent lab test fulfill the aforementioned systolic/diastolic BP criteria.</p>
</section>
<section id="hypertensive-crisis-with-target-organ-damage" class="level2">
<h2 class="anchored" data-anchor-id="hypertensive-crisis-with-target-organ-damage">Hypertensive Crisis with Target-Organ Damage</h2>
<p>What percent of hypertension patients with a referral have a life-threatening condition that could trigger a hypertensive crises?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> numbered_conditions <span class="kw">AS</span> (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        patient, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">CASE</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="fu">LOWER</span>(reasondescription) ~<span class="op">*</span> <span class="st">'acute aortic dissection|acute kidney injury|acute myocardial ischaemia|acute heart failure|stroke|phaeochromocytoma'</span> <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">ELSE</span> <span class="dv">0</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span> <span class="kw">AS</span> hypertensive_crisis_condition</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> encounters</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>hypertensive_crises_cohort <span class="kw">AS</span> (</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    patient,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MAX</span>(hypertensive_crisis_condition) <span class="kw">AS</span> hypertensive_crisis_condition</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> numbered_conditions</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> patient</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>joined_hypertension_cohort <span class="kw">AS</span> (</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> hr.patient, referral, hypertensive_crisis_condition</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referral_cohort hr</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> hypertensive_crises_cohort hc</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> hr.patient <span class="op">=</span> hc.patient</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> referral <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(hypertensive_crisis_condition) <span class="kw">AS</span> hypertensive_crises_condition_patients,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(referral) <span class="kw">AS</span> total_referral_patients,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(hypertensive_crisis_condition) <span class="op">*</span> <span class="fl">100.0</span><span class="op">/</span><span class="fu">SUM</span>(referral) <span class="kw">AS</span> percent_with_crisis_condition</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> joined_hypertension_cohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 25%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">hypertensive_crises_condition_patients</th>
<th style="text-align: right;">total_referral_patients</th>
<th style="text-align: right;">percent_with_crisis_condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>None of the patients in our cohort have such a life-threatening condition.</p>
</section>
<section id="pre-eclampsia-and-severe-hypertension-in-pregnancy" class="level2">
<h2 class="anchored" data-anchor-id="pre-eclampsia-and-severe-hypertension-in-pregnancy">Pre-Eclampsia and Severe Hypertension in Pregnancy</h2>
<p>What percent of hypertension patients with a referral have the condition, pre–eclampsia?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> preeclampsia_cohort <span class="kw">AS</span> (</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> patient, <span class="dv">1</span> <span class="kw">AS</span> preeclampsia</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> conditions</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="fu">LOWER</span>(description) <span class="kw">LIKE</span> <span class="st">'%preeclampsia%'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>joined_hypertension_cohort <span class="kw">AS</span> (</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> hr.patient, hr.referral, p.preeclampsia</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> hypertension_referral_cohort hr</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> preeclampsia_cohort p </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> hr.patient <span class="op">=</span> p.patient</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> referral <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(preeclampsia) <span class="kw">AS</span> preeclampsia_patients,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(referral) <span class="kw">AS</span> total_referral_patients,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SUM</span>(preeclampsia) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">SUM</span>(referral) <span class="kw">AS</span> percent_with_preeclampsia</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> joined_hypertension_cohort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 33%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">preeclampsia_patients</th>
<th style="text-align: right;">total_referral_patients</th>
<th style="text-align: right;">percent_with_preeclampsia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">6.763285</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Based on the <strong>more stringent referral criteria</strong>, only <strong>6.76% (14 patients)</strong> of the <strong>hypertension cohort referred to a hypertension clinic</strong> were appropriately referred due to <strong>pre-eclampsia</strong>.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li>Lewis P, George J, Kapil V, et al.&nbsp;Adult hypertension referral pathway and therapeutic management: British and Irish Hypertension Society position statement. <em>Journal of Human Hypertension</em>. 2024;38(1):3-7. doi:https://doi.org/10.1038/s41371-023-00882-2</li>
</ol>
<p>‌</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
